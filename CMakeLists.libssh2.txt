



OPTION( INCLUDE_LIBSSH2 "Include libssh2 interfaces" ON )
OPTION( NEED_LIBSSH2 "Build internal libssh2 library" ON )

	if( WIN32 ) 
	  set( EXTENSION .lib )
	  else( WIN32 )
	  set( EXTENSION .a )
	  endif( WIN32 )

    set( SSH_LIBS ${CMAKE_BINARY_DIR}/libssh2_tmp/lib/libssh2${EXTENSION} )

if( INCLUDE_LIBSSH2 )
	include_directories( src/sack/libssh2/include )
	LINK_DIRECTORIES( ${CMAKE_BINARY_DIR}/libssh2_tmp/lib )
	
	ExternalProject_Add( Libssh2_External
		BUILD_ALWAYS ON
      DEPENDS Libressl_External
		SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/src/sack/libssh2/
		BINARY_DIR ${CMAKE_BINARY_DIR}/libssh2
		INSTALL_DIR ${CMAKE_BINARY_DIR}_tmp
		BUILD_BYPRODUCTS ${SSH_LIBS}
		CMAKE_ARGS -DCMAKE_INSTALL_PREFIX:PATH=<BINARY_DIR>_tmp
			-DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
			${MOREOPTS}
			-DCMAKE_POSITION_INDEPENDENT_CODE=ON
			-DLIBSSH2_EXPORT_SYMBOLS=ON
			-DLIBSSH2_BUILD_OBJECT_LIBRARY=OFF
			-DLIBSSH2_DISABLE_INSTALL=OFF
			-DLIBRESSL_INSTALL_DIR=${CMAKE_BINARY_DIR}/lssl_tmp
			-DBUILD_SHARED_LIBS=OFF
			-DBUILD_STATIC_LIBS=ON
			-DBUILD_EXAMPLES=OFF
			-DBUILD_TESTING=OFF
			-DBUILD_DOCS=OFF
			-DLIBSSH2_BUILD_EXAMPLES=OFF
			-DLIBSSH2_BUILD_TESTING=OFF
			-DLIBSSH2_BUILD_DOCS=OFF
	)
#message( "SSH LIB: ${SSH_LIBS}" )
#	add_dependencies( ${SSH_LIBS} Libssh2_External )
else( INCLUDE_LIBSSH2 )

endif( INCLUDE_LIBSSH2)
